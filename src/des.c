#include <stdio.h>

#include "../header/des.h"

inline __uint64_t initial_permutation(__uint64_t value) {
    __uint64_t p = 0x00;

    p = ((value & 0x00000000000040) << 57) | ((value & 0x0000000000004000) << 48) |
        ((value & 0x00000000400000) << 39) | ((value & 0x0000000040000000) << 30) |
        ((value & 0x00004000000000) << 21) | ((value & 0x0000400000000000) << 12) |
        ((value & 0x40000000000000) << 3)  | ((value & 0x4000000000000000) >> 6)  |

        ((value & 0x00000000000010) << 51) | ((value & 0x0000000000001000) << 42) |
        ((value & 0x00000000100000) << 33) | ((value & 0x0000000010000000) << 24) |
        ((value & 0x00001000000000) << 15) | ((value & 0x0000100000000000) << 6)  |
        ((value & 0x10000000000000) >> 3)  | ((value & 0x1000000000000000) >> 12) |

        ((value & 0x0000000000004) << 45) | ((value & 0x000000000000400) << 36) |
        ((value & 0x0000000040000) << 27) | ((value & 0x000000004000000) << 18) |
        ((value & 0x0000400000000) << 9)  |  (value & 0x000040000000000)        |
        ((value & 0x4000000000000) >> 9)  | ((value & 0x400000000000000) >> 18) |

        ((value & 0x0000000000001) << 39) | ((value & 0x000000000000100) << 30) |
        ((value & 0x0000000010000) << 21) | ((value & 0x000000001000000) << 12) |
        ((value & 0x0000100000000) << 3)  | ((value & 0x000010000000000) >> 6)  |
        ((value & 0x1000000000000) >> 15) | ((value & 0x100000000000000) >> 24) |

        ((value & 0x00000000000080) << 24) | ((value & 0x0000000000008000) << 15) |
        ((value & 0x00000000800000) << 6)  | ((value & 0x0000000080000000) >> 3)  |
        ((value & 0x00008000000000) >> 12) | ((value & 0x0000800000000000) >> 21) |
        ((value & 0x80000000000000) >> 30) | ((value & 0x8000000000000000) >> 39) |

        ((value & 0x00000000000020) << 18) | ((value & 0x0000000000002000) << 9)  |
         (value & 0x00000000200000)        | ((value & 0x0000000020000000) >> 9)  |
        ((value & 0x00002000000000) >> 18) | ((value & 0x0000200000000000) >> 27) |
        ((value & 0x20000000000000) >> 36) | ((value & 0x2000000000000000) >> 45) |

        ((value & 0x0000000000008) << 12) | ((value & 0x000000000000800) << 3)  |
        ((value & 0x0000000080000) >> 6)  | ((value & 0x000000008000000) >> 15) |
        ((value & 0x0000800000000) >> 24) | ((value & 0x000080000000000) >> 33) |
        ((value & 0x8000000000000) >> 42) | ((value & 0x800000000000000) >> 51) |

        ((value & 0x0000000000002) << 6)  | ((value & 0x000000000000200) >> 3)  |
        ((value & 0x0000000020000) >> 12) | ((value & 0x000000002000000) >> 21) |
        ((value & 0x0000200000000) >> 30) | ((value & 0x000020000000000) >> 39) |
        ((value & 0x2000000000000) >> 48) | ((value & 0x200000000000000) >> 57);

    return p;
}

inline __uint64_t expansion(__uint32_t R) {
    __uint64_t e = 0x00;
    __uint64_t value = R;

    e = ((value & 0x000000001) << 47) | ((value & 0xF8000000) << 15) | ((value & 0x1F800000) << 13) |
        ((value & 0x001F80000) << 11) | ((value & 0x001F8000) << 9)  | ((value & 0x0001F800) << 7)  |
        ((value & 0x000001F80) << 5)  | ((value & 0x000001F8) << 3)  | ((value & 0x0000001F) << 1)  | 
        ((value & 0x080000000) >> 31);

    return e;
}

inline __uint32_t permutation_inv(__uint32_t R) {
    __uint32_t p_inv = 0x00;

    p_inv = ((R & 0x00800000) << 8)  | ((R & 0x008000) << 15) | ((R & 0x00000200) << 20) | ((R & 0x00000002) << 27) | 
            ((R & 0x00080000) << 8)  | ((R & 0x000010) << 22) | ((R & 0x40000000) >> 5)  | ((R & 0x00004000) << 10) |
            ((R & 0x00000100) << 15) | ((R & 0x010000) << 6)  | ((R & 0x00000004) << 19) | ((R & 0x04000000) >> 6)  |
            ((R & 0x00000040) << 13) | ((R & 0x001000) << 6)  | ((R & 0x00400000) >> 5)  | ((R & 0x80000000) >> 15) |
            ((R & 0x01000000) >> 9)  | ((R & 0x040000) >> 4)  | ((R & 0x00000080) << 6)  | ((R & 0x20000000) >> 17) |
            ((R & 0x10000000) >> 17) | ((R & 0x000008) << 7)  | ((R & 0x00200000) >> 12) | ((R & 0x00002000) >> 5)  |
            ((R & 0x00000001) << 7)  | ((R & 0x100000) >> 14) | ((R & 0x00000400) >> 5)  | ((R & 0x02000000) >> 21) |
            ((R & 0x08000000) >> 24) | ((R & 0x000020) >> 3)  | ((R & 0x00020000) >> 16) | ((R & 0x00000800) >> 11);

    return p_inv;
}

inline __uint64_t pc1_inv(__uint64_t value) {
    __uint64_t pc1 = 0x00;

    pc1 = ((value & 0x1000000000000) << 15) | ((value & 0x10000000000) << 22) | ((value & 0x100000000) << 29) | 
          ((value & 0x0000000000001) << 60) | ((value & 0x00000000010) << 55) | ((value & 0x000001000) << 46) |

          ((value & 0x000100000) << 37) | ((value & 0x2000000000000) << 6)  | ((value & 0x20000000000) << 13) | 
          ((value & 0x200000000) << 20) | ((value & 0x0000000000002) << 51) |

          ((value & 0x0000000000020) << 46) | ((value & 0x0000000002000) << 37) | ((value & 0x00000200000) << 28) | 
          ((value & 0x4000000000000) >> 3)  | ((value & 0x0040000000000) << 4)  |

          ((value & 0x400000000) << 11) | ((value & 0x000004) << 42) | ((value & 0x40) << 37) | 
          ((value & 0x000004000) << 28) | ((value & 0x400000) << 19) | 

          ((value & 0x8000000000000) >> 12) | ((value & 0x80000000000) >> 5)  | ((value & 0x800000000) << 2)  | 
          ((value & 0x0000000000008) << 33) | ((value & 0x00000000080) << 28) | ((value & 0x000008000) << 19) |

          ((value & 0x000000800000) << 10) | ((value & 0x10000000000000) >> 21) | 
          ((value & 0x100000000000) >> 14) | ((value & 0x00001000000000) >> 7)  | (value & 0x00000010000000) |

          ((value & 0x00000000000100) << 19) | ((value & 0x00000000010000) << 10) | ((value & 0x000001000000) << 1)  | 
          ((value & 0x20000000000000) >> 30) | ((value & 0x00200000000000) >> 23) |

          ((value & 0x2000000000) >> 16) | ((value & 0x20000000) >> 9) | ((value & 0x200) << 10) | 
          ((value & 0x0000020000) << 1)  | ((value & 0x02000000) >> 8) |

          ((value & 0x40000000000000) >> 39) | ((value & 0x400000000000) >> 32) | ((value & 0x4000000000) >> 25) | 
          ((value & 0x00000040000000) >> 18) | ((value & 0x000000000400) << 1)  | ((value & 0x0000040000) >> 8)  |

          ((value & 0x0000004000000) >> 17) | ((value & 0x80000000000000) >> 48) | 
          ((value & 0x0800000000000) >> 41) | ((value & 0x00008000000000) >> 34) | ((value & 0x00000080000000) >> 27) |

          ((value & 0x800) >> 8) | ((value & 0x80000) >> 17) | ((value & 0x8000000) >> 26); 

    return pc1;
}

inline __uint64_t pc2_inv(__uint64_t value) {
    __uint64_t pc2 = 0x00;

    pc2 = ((value & 0x80000000000) << 12) | ((value & 0x00001000000) << 30) | ((value & 0x20000000000) << 12) |
          ((value & 0x00100000000) << 20) | ((value & 0x40000000000) << 9)  | ((value & 0x04000000000) << 12) |
          
          ((value & 0x0010000000) << 22) | ((value & 0x000040000000) << 18) |
          ((value & 0x1000000000) << 10) |  (value & 0x200000000000)        | ((value & 0x200000000) << 11) |

          ((value & 0x02000000) << 18) | ((value & 0x800000000000) >> 5) | ((value & 0x8000000000) >> 2) |
          ((value & 0x20000000) << 11) | ((value & 0x400000000000) >> 7) |

          ((value & 0x400000000) << 3) | ((value & 0x000004000000) << 10) | ((value & 0x002000000000) >> 2) |
          ((value & 0x800000000) >> 2) | ((value & 0x100000000000) >> 12) |

          ((value & 0x80000000) >> 1)  | ((value & 0x8000000) << 2) | ((value & 0x10000000000) >> 12) | 
          ((value & 0x00000002) << 26) | ((value & 0x0020000) << 9) |

          ((value & 0x200000) << 4)  | ((value & 0x0001) << 24) | ((value & 0x2000) << 10) |
          ((value & 0x000080) << 15) | ((value & 0x0004) << 18) |

          ((value & 0x100000) >> 1) | ((value & 0x200) << 8)  | (value & 0x010000) | 
          ((value & 0x800000) >> 8) | ((value & 0x010) << 10) |

          ((value & 0x00800) << 1)  | ((value & 0x4000) >> 3) | ((value & 0x00020) << 5) |
          ((value & 0x80000) >> 10) | ((value & 0x1000) >> 4) |

          ((value & 0x000400) >> 3)  | ((value & 0x08) << 3) | ((value & 0x8000) >> 10) |
          ((value & 0x400000) >> 18) | ((value & 0x40) >> 3) | 

          ((value & 0x40000) >> 17) | ((value & 0x100) >> 8);

    return pc2;
}

inline __uint32_t get_L(__uint64_t value) {
    return ((value >> 32) & 0xFFFFFFFF);
}

inline __uint32_t get_R(__uint64_t value) {
    return (value & 0xFFFFFFFF);
}