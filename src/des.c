#include <stdio.h>

#include "../header/des.h"

void print_binary_64(__uint64_t number)
{
    if (number >> 1) {
        print_binary_64(number >> 1);
    }
    putc((number & 1) ? '1' : '0', stdout);
}

void print_binary_32(__uint32_t number)
{
    if (number >> 1) {
        print_binary_32(number >> 1);
    }
    putc((number & 1) ? '1' : '0', stdout);
}

__uint64_t initial_permutation(__uint64_t value) {
    __uint64_t p = 0x00;

    p = ((value & 0x00000000000040) << 57) | ((value & 0x0000000000004000) << 48) |
        ((value & 0x00000000400000) << 39) | ((value & 0x0000000040000000) << 30) |
        ((value & 0x00004000000000) << 21) | ((value & 0x0000400000000000) << 12) |
        ((value & 0x40000000000000) << 3)  | ((value & 0x4000000000000000) >> 6)  |

        ((value & 0x00000000000010) << 51) | ((value & 0x0000000000001000) << 42) |
        ((value & 0x00000000100000) << 33) | ((value & 0x0000000010000000) << 24) |
        ((value & 0x00001000000000) << 21) | ((value & 0x0000100000000000) << 6)  |
        ((value & 0x10000000000000) >> 3)  | ((value & 0x1000000000000000) >> 12) |

        ((value & 0x0000000000004) << 45) | ((value & 0x000000000000400) << 36) |
        ((value & 0x0000000040000) << 27) | ((value & 0x000000004000000) << 18) |
        ((value & 0x0000400000000) << 9)  |  (value & 0x000040000000000)        |
        ((value & 0x4000000000000) >> 9)  | ((value & 0x400000000000000) >> 18) |

        ((value & 0x0000000000001) << 39) | ((value & 0x000000000000100) << 30) |
        ((value & 0x0000000010000) << 21) | ((value & 0x000000001000000) << 12) |
        ((value & 0x0000100000000) << 3)  | ((value & 0x000010000000000) >> 6)  |
        ((value & 0x1000000000000) >> 15) | ((value & 0x100000000000000) >> 24) |

        ((value & 0x00000000000080) << 24) | ((value & 0x0000000000008000) << 15) |
        ((value & 0x00000000800000) << 6)  | ((value & 0x0000000080000000) >> 3)  |
        ((value & 0x00008000000000) >> 12) | ((value & 0x0000800000000000) >> 21) |
        ((value & 0x80000000000000) >> 30) | ((value & 0x8000000000000000) >> 39) |

        ((value & 0x00000000000020) << 18) | ((value & 0x0000000000002000) << 9)  |
         (value & 0x00000000200000)        | ((value & 0x0000000020000000) >> 9)  |
        ((value & 0x00002000000000) >> 18) | ((value & 0x0000200000000000) >> 27) |
        ((value & 0x20000000000000) >> 36) | ((value & 0x2000000000000000) >> 45) |

        ((value & 0x0000000000008) << 12) | ((value & 0x000000000000800) << 3)  |
        ((value & 0x0000000080000) >> 6)  | ((value & 0x000000008000000) >> 15) |
        ((value & 0x0000800000000) >> 24) | ((value & 0x000080000000000) >> 33) |
        ((value & 0x8000000000000) >> 42) | ((value & 0x800000000000000) >> 51) |

        ((value & 0x0000000000002) << 6)  | ((value & 0x000000000000200) >> 3)  |
        ((value & 0x0000000020000) >> 12) | ((value & 0x000000002000000) >> 21) |
        ((value & 0x0000200000000) >> 30) | ((value & 0x000020000000000) >> 39) |
        ((value & 0x2000000000000) >> 48) | ((value & 0x200000000000000) >> 57);

    return p;
}

__uint64_t expansion(__uint32_t R) {
    __uint64_t e = 0x00;
    __uint64_t value = R;

    e = ((value & 0x000000001) << 47) | ((value & 0xF8000000) << 15) | ((value & 0x1F800000) << 13) |
        ((value & 0x001F80000) << 11) | ((value & 0x001F8000) << 9)  | ((value & 0x0001F800) << 7)  |
        ((value & 0x000001F80) << 5)  | ((value & 0x000001F8) << 3)  | ((value & 0x0000001F) << 1)  | 
        ((value & 0x080000000) >> 31);

    return e;
}

__uint32_t permutation_inv(__uint32_t R) {
    __uint32_t p_inv = 0x00;

    p_inv = ((R & 0x00800000) << 8)  | ((R & 0x008000) << 15) | ((R & 0x00000200) << 20) | ((R & 0x00000002) << 27) | 
            ((R & 0x00080000) << 8)  | ((R & 0x000010) << 22) | ((R & 0x40000000) >> 5)  | ((R & 0x00004000) << 10) |
            ((R & 0x00000100) << 15) | ((R & 0x010000) << 6)  | ((R & 0x00000004) << 19) | ((R & 0x04000000) << 6)  |
            ((R & 0x00000040) << 13) | ((R & 0x001000) << 6)  | ((R & 0x00400000) >> 5)  | ((R & 0x80000000) >> 15) |
            ((R & 0x01000000) >> 9)  | ((R & 0x040000) >> 4)  | ((R & 0x00000080) << 6)  | ((R & 0x20000000) >> 17) |
            ((R & 0x10000000) >> 17) | ((R & 0x000008) << 7)  | ((R & 0x00200000) >> 12) | ((R & 0x00002000) >> 5)  |
            ((R & 0x00000001) << 7)  | ((R & 0x100000) >> 14) | ((R & 0x00000400) >> 5)  | ((R & 0x02000000) >> 21) |
            ((R & 0x08000000) >> 24) | ((R & 0x000020) >> 3)  | ((R & 0x00020000) >> 16) | ((R & 0x00000800) >> 11);

    return p_inv;
}

void get_L16_R16(__uint64_t value, __uint32_t *L16, __uint32_t *R16) {
    *L16 = (value >> 32) & 0xFFFFFFFF;
    *R16 = value & 0xFFFFFFFF;
}
